{% extends "base.html" %}

{% block title %}DhristiAI - Camera Management{% endblock %}

{% block content %}
<header class="dashboard-header glass-card" id="live-feeds-section">
    <div class="header-title">
        <h1>Camera Management</h1>
        <p>View and manage all connected camera feeds</p>
    </div>
    <div class="header-actions">
        <div class="real-time-status">
            <span class="status-dot"></span> <span>{{ cameras|length }} Camera{{ 's' if cameras|length != 1 else '' }} Online</span>
        </div>
        <div class="user-profile">
            <div class="user-avatar-placeholder">A</div>
            <span>Admin</span>
        </div>
    </div>
</header>

<div class="camera-management-container glass-card">
    <h4><i class="fas fa-plus-circle"></i> Add Camera</h4>
    <!-- Display flashed messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    <form action="{{ url_for('add_camera') }}" method="POST" class="camera-form">
        <input type="text" id="camera-url" name="camera_url" placeholder="http://192.168.1.10:8080" class="form-control" required>
        <input type="text" id="zone-name" name="zone_name" placeholder="Zone Name (e.g. Entrance, Lobby, Parking)" class="form-control" required>
        <button type="submit" class="btn-primary"><i class="fas fa-plus"></i> Add Camera</button>
    </form>
    <div class="description">
        <p><i class="fas fa-info-circle"></i> Enter the base URL of the camera. The system will append "/video" for the stream.</p>
    </div>
</div>

<div class="live-feeds-grid" id="feeds-container">
    {% if cameras %}
        {% for camera in cameras %}
        <div class="glass-card feed-card" data-id="{{ camera._id }}">
            <div class="feed-video">
                <iframe src="{{ camera.url }}/video" width="100%" height="100%" allowfullscreen="" frameborder="0" title="Camera {{ loop.index }}"></iframe>
            </div>
            <div class="feed-info">
                <div class="feed-title">
                    <h3>Camera {{ loop.index }}</h3>
                    <span class="feed-status online">Online</span>
                </div>
                <p>{{ camera.url }}</p>
                <div class="feed-actions">
                    <a href="{{ url_for('dashboard') }}?camera={{ camera._id }}" class="btn-primary btn-sm" style="flex: 1;"><i class="fas fa-chart-line"></i> View Stats</a>
                    <button class="btn-secondary btn-sm delete-btn" data-camera-id="{{ camera._id }}" data-camera-url="{{ camera.url }}"><i class="fas fa-trash"></i></button>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="glass-card feed-card empty-state">
            <div class="feed-video">
                <div class="video-placeholder">
                    <i class="fas fa-video-slash"></i>
                    <p>No cameras added</p>
                </div>
            </div>
            <div class="feed-info">
                <div class="feed-title">
                    <h3>Add your first camera</h3>
                    <span class="feed-status offline">Offline</span>
                </div>
                <p>Use the form above to add a new camera feed</p>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block modals %}
<div class="modal" id="delete-confirm-modal">
    <div class="modal-content glass-card">
        <div class="modal-header">
            <h3>Confirm Deletion</h3>
            <button class="close-modal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to remove this camera?</p>
            <p class="camera-url" style="font-weight: bold; margin-top: 10px;"></p>
        </div>
        <div class="modal-footer">
            <form id="delete-form" method="POST" action="">
                <button type="button" class="btn-secondary" id="cancel-delete">Cancel</button>
                <button type="submit" class="btn-primary">Delete</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/camera-management.js') }}"></script>
{% endblock %}
